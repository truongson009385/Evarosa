/*! jquery.cookie v1.4.1 | MIT */
!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?n(require("jquery")):n(jQuery)}(function(n){function i(n){return t.raw?n:encodeURIComponent(n)}function u(n){return t.raw?n:decodeURIComponent(n)}function f(n){return i(t.json?JSON.stringify(n):String(n))}function e(n){0===n.indexOf('"')&&(n=n.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return n=decodeURIComponent(n.replace(o," ")),t.json?JSON.parse(n):n}catch(i){}}function r(i,r){var u=t.raw?i:e(i);return n.isFunction(r)?r(u):u}var o=/\+/g,t=n.cookie=function(e,o,s){var v,c;if(void 0!==o&&!n.isFunction(o))return(s=n.extend({},t.defaults,s),"number"==typeof s.expires)&&(v=s.expires,c=s.expires=new Date,c.setTime(+c+864e5*v)),document.cookie=[i(e),"=",f(o),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("");for(var l=e?void 0:{},y=document.cookie?document.cookie.split("; "):[],a=0,b=y.length;b>a;a++){var p=y[a].split("="),w=u(p.shift()),h=p.join("=");if(e&&e===w){l=r(h,o);break}e||void 0===(h=r(h))||(l[w]=h)}return l};t.defaults={};n.removeCookie=function(t,i){return void 0===n.cookie(t)?!1:(n.cookie(t,"",n.extend({},i,{expires:-1})),!n.cookie(t))}});"function"!=typeof Object.create&&(Object.create=function(n){function t(){}return t.prototype=n,new t}),function(n,t){"use strict";var i={_positionClasses:["bottom-left","bottom-right","top-right","top-left","bottom-center","top-center","mid-center"],_defaultIcons:["success","error","info","warning"],init:function(t){this.prepareOptions(t,n.toast.options);this.process()},prepareOptions:function(t,i){var r={};"string"==typeof t||t instanceof Array?r.text=t:r=t;this.options=n.extend({},i,r)},process:function(){this.setup();this.addToDom();this.position();this.bindToast();this.animate()},setup:function(){var t="",i;if(this._toastEl=this._toastEl||n("<div><\/div>",{"class":"jq-toast-single"}),t+='<span class="jq-toast-loader"><\/span>',this.options.allowToastClose&&(t+='<span class="close-jq-toast-single">&times;<\/span>'),this.options.text instanceof Array){for(this.options.heading&&(t+='<h2 class="jq-toast-heading">'+this.options.heading+"<\/h2>"),t+='<ul class="jq-toast-ul">',i=0;i<this.options.text.length;i++)t+='<li class="jq-toast-li" id="jq-toast-item-'+i+'">'+this.options.text[i]+"<\/li>";t+="<\/ul>"}else this.options.heading&&(t+='<h2 class="jq-toast-heading">'+this.options.heading+"<\/h2>"),t+=this.options.text;this._toastEl.html(t);this.options.bgColor!==!1&&this._toastEl.css("background-color",this.options.bgColor);this.options.textColor!==!1&&this._toastEl.css("color",this.options.textColor);this.options.textAlign&&this._toastEl.css("text-align",this.options.textAlign);this.options.icon!==!1&&(this._toastEl.addClass("jq-has-icon"),-1!==n.inArray(this.options.icon,this._defaultIcons)&&this._toastEl.addClass("jq-icon-"+this.options.icon));this.options["class"]!==!1&&this._toastEl.addClass(this.options["class"])},position:function(){"string"==typeof this.options.position&&-1!==n.inArray(this.options.position,this._positionClasses)?"bottom-center"===this.options.position?this._container.css({left:n(t).outerWidth()/2-this._container.outerWidth()/2,bottom:20}):"top-center"===this.options.position?this._container.css({left:n(t).outerWidth()/2-this._container.outerWidth()/2,top:20}):"mid-center"===this.options.position?this._container.css({left:n(t).outerWidth()/2-this._container.outerWidth()/2,top:n(t).outerHeight()/2-this._container.outerHeight()/2}):this._container.addClass(this.options.position):"object"==typeof this.options.position?this._container.css({top:this.options.position.top?this.options.position.top:"auto",bottom:this.options.position.bottom?this.options.position.bottom:"auto",left:this.options.position.left?this.options.position.left:"auto",right:this.options.position.right?this.options.position.right:"auto"}):this._container.addClass("bottom-left")},bindToast:function(){var n=this;this._toastEl.on("afterShown",function(){n.processLoader()});this._toastEl.find(".close-jq-toast-single").on("click",function(t){t.preventDefault();"fade"===n.options.showHideTransition?(n._toastEl.trigger("beforeHide"),n._toastEl.fadeOut(function(){n._toastEl.trigger("afterHidden")})):"slide"===n.options.showHideTransition?(n._toastEl.trigger("beforeHide"),n._toastEl.slideUp(function(){n._toastEl.trigger("afterHidden")})):(n._toastEl.trigger("beforeHide"),n._toastEl.hide(function(){n._toastEl.trigger("afterHidden")}))});"function"==typeof this.options.beforeShow&&this._toastEl.on("beforeShow",function(){n.options.beforeShow()});"function"==typeof this.options.afterShown&&this._toastEl.on("afterShown",function(){n.options.afterShown()});"function"==typeof this.options.beforeHide&&this._toastEl.on("beforeHide",function(){n.options.beforeHide()});"function"==typeof this.options.afterHidden&&this._toastEl.on("afterHidden",function(){n.options.afterHidden()})},addToDom:function(){var t=n(".jq-toast-wrap"),r,i;(0===t.length?(t=n("<div><\/div>",{"class":"jq-toast-wrap"}),n("body").append(t)):(!this.options.stack||isNaN(parseInt(this.options.stack,10)))&&t.empty(),t.find(".jq-toast-single:hidden").remove(),t.append(this._toastEl),this.options.stack&&!isNaN(parseInt(this.options.stack),10))&&(r=t.find(".jq-toast-single").length,i=r-this.options.stack,i>0&&n(".jq-toast-wrap").find(".jq-toast-single").slice(0,i).remove());this._container=t},canAutoHide:function(){return this.options.hideAfter!==!1&&!isNaN(parseInt(this.options.hideAfter,10))},processLoader:function(){if(!this.canAutoHide()||this.options.loader===!1)return!1;var i=this._toastEl.find(".jq-toast-loader"),t=(this.options.hideAfter-400)/1e3+"s",r=this.options.loaderBg,n=i.attr("style")||"";n=n.substring(0,n.indexOf("-webkit-transition"));n+="-webkit-transition: width "+t+" ease-in;                       -o-transition: width "+t+" ease-in;                       transition: width "+t+" ease-in;                       background-color: "+r+";";i.attr("style",n).addClass("jq-toast-loaded")},animate:function(){var n=this;(this._toastEl.hide(),this._toastEl.trigger("beforeShow"),"fade"===this.options.showHideTransition.toLowerCase()?this._toastEl.fadeIn(function(){n._toastEl.trigger("afterShown")}):"slide"===this.options.showHideTransition.toLowerCase()?this._toastEl.slideDown(function(){n._toastEl.trigger("afterShown")}):this._toastEl.show(function(){n._toastEl.trigger("afterShown")}),this.canAutoHide())&&(n=this,t.setTimeout(function(){"fade"===n.options.showHideTransition.toLowerCase()?(n._toastEl.trigger("beforeHide"),n._toastEl.fadeOut(function(){n._toastEl.trigger("afterHidden")})):"slide"===n.options.showHideTransition.toLowerCase()?(n._toastEl.trigger("beforeHide"),n._toastEl.slideUp(function(){n._toastEl.trigger("afterHidden")})):(n._toastEl.trigger("beforeHide"),n._toastEl.hide(function(){n._toastEl.trigger("afterHidden")}))},this.options.hideAfter))},reset:function(t){"all"===t?n(".jq-toast-wrap").remove():this._toastEl.remove()},update:function(n){this.prepareOptions(n,this.options);this.setup();this.bindToast()}};n.toast=function(n){var t=Object.create(i);return t.init(n,this),{reset:function(n){t.reset(n)},update:function(n){t.update(n)}}};n.toast.options={text:"",heading:"",showHideTransition:"fade",allowToastClose:!0,hideAfter:3e3,loader:!0,loaderBg:"#9EC600",stack:5,position:"bottom-left",bgColor:!1,textColor:!1,textAlign:"left",icon:!1,beforeShow:function(){},afterShown:function(){},beforeHide:function(){},afterHidden:function(){}}}(jQuery,window,document);!function(n){var i,t;n.fn.tagify=function(t={}){return this.each(function(){var r,i=n(this);if(i.data("tagify"))return this;t.isJQueryPlugin=!0;r=new Tagify(i[0],t);i.data("tagify",r)})};i=this;t=function(){"use strict";function p(n,t){var r=Object.keys(n),i;return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(n),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,i)),r}function i(n){for(var i,t=1;t<arguments.length;t++)i=null!=arguments[t]?arguments[t]:{},t%2?p(Object(i),!0).forEach(function(t){ft(n,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(i,t))});return n}function ft(n,t,i){return(t=function(n){var t=function(n){var t,i;if("object"!=typeof n||null===n)return n;if(t=n[Symbol.toPrimitive],void 0!==t){if(i=t.call(n,"string"),"object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.");}return String(n)}(n);return"symbol"==typeof t?t:String(t)}(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function a(n,t){var i,r={};for(i in n)t.indexOf(i)<0&&(r[i]=n[i]);return r}function b(n){var t=document.createElement("div");return n.replace(/\&#?[0-9a-z]+;/gi,function(n){return t.innerHTML=n,t.innerText})}function v(n){return(new DOMParser).parseFromString(n.trim(),"text/html").body.firstElementChild}function k(n,t){for(t=t||"previous";n=n[t+"Sibling"];)if(3==n.nodeType)return n}function e(n){return"string"==typeof n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):n}function r(n){var t=Object.prototype.toString.call(n).split(" ")[1].slice(0,-1);return n===Object(n)&&"Array"!=t&&"Function"!=t&&"RegExp"!=t&&"HTMLUnknownElement"!=t}function t(n,t,i){function u(n,t){for(var i in t)if(t.hasOwnProperty(i)){if(r(t[i])){r(n[i])?u(n[i],t[i]):n[i]=Object.assign({},t[i]);continue}if(Array.isArray(t[i])){n[i]=Object.assign([],t[i]);continue}n[i]=t[i]}}return n instanceof Object||(n={}),u(n,t),i&&u(n,i),n}function d(){const n=[],t={};for(let i of arguments)for(let u of i)r(u)?t[u.value]||(n.push(u),t[u.value]=1):n.includes(u)||n.push(u);return n}function c(n){return String.prototype.normalize?"string"==typeof n?n.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:n}function g(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,n=>(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16))}function o(n){return n&&n.classList&&n.classList.contains(this.settings.classNames.tag)}function nt(n,t){var i=window.getSelection();return t=t||i.getRangeAt(0),"string"==typeof n&&(n=document.createTextNode(n)),t&&(t.deleteContents(),t.insertNode(n)),n}function n(n,i,r){return n?(i&&(n.__tagifyTagData=r?i:t({},n.__tagifyTagData||{},i)),n.__tagifyTagData):(Tagify.logger.warn("tag element doesn't exist",{tagElm:n,data:i}),i)}function f(n){if(n&&n.parentNode){var r=n,t=window.getSelection(),i=t.getRangeAt(0);t.rangeCount&&(i.setStartAfter(r),i.collapse(!0),t.removeAllRanges(),t.addRange(i))}}function tt(t,i){t.forEach(t=>{if(n(t.previousSibling)||!t.previousSibling){var r=document.createTextNode("​");t.before(r);i&&f(r)}})}function et(){this.dropdown={};for(let n in this._dropdown)this.dropdown[n]="function"==typeof this._dropdown[n]?this._dropdown[n].bind(this):this._dropdown[n];this.dropdown.refs()}function u(n,i){if(!n){u.logger.warn("input element not found",n);const t=new Proxy(this,{get:()=>()=>t});return t}if(n.__tagify)return u.logger.warn("input element is already Tagified - Same instance is returned.",n),n.__tagify;var r;t(this,function(n){function r(n,t,r){r&&t.split(/\s+/g).forEach(t=>i[n+"EventListener"].call(i,t,r))}var i=document.createTextNode("");return{off(n,t){return r("remove",n,t),this},on(n,t){return t&&"function"==typeof t&&r("add",n,t),this},trigger(r,u,f){var s,e,o;if(f=f||{cloneData:!0},r)if(n.settings.isJQueryPlugin)"remove"==r&&(r="removeTag"),jQuery(n.DOM.originalInput).triggerHandler(r,[u]);else{try{if(e="object"==typeof u?u:{value:u},(e=f.cloneData?t({},e):e).tagify=this,u.event&&(e.event=this.cloneEvent(u.event)),u instanceof Object)for(o in u)u[o]instanceof HTMLElement&&(e[o]=u[o]);s=new CustomEvent(r,{detail:e})}catch(n){Tagify.logger.warn(n)}i.dispatchEvent(s)}}}}(this));this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent);this.isIE=window.document.documentMode;i=i||{};this.getPersistedData=(r=i.id,n=>{let t,i="/"+n;if(1==localStorage.getItem(h+r+"/v",1))try{t=JSON.parse(localStorage[h+r+i])}catch(n){}return t});this.setPersistedData=(n=>n?(localStorage.setItem(h+n+"/v",1),(t,i)=>{let r="/"+i,u=JSON.stringify(t);t&&i&&(localStorage.setItem(h+n+r,u),dispatchEvent(new Event("storage")))}):()=>{})(i.id);this.clearPersistedData=(n=>t=>{const i=h+"/"+n+"/";if(t)localStorage.removeItem(i+t);else for(let n in localStorage)n.includes(i)&&localStorage.removeItem(n)})(i.id);this.applySettings(n,i);this.state={inputText:"",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}};this.value=[];this.listeners={};this.DOM={};this.build(n);et.call(this);this.getCSSVars();this.loadOriginalValues();this.events.customBinding.call(this);this.events.binding.call(this);n.autofocus&&this.DOM.input.focus();n.__tagify=this}var y,l,it,rt;const s=(n,t,i,r)=>(n=""+n,t=""+t,r&&(n=n.trim(),t=t.trim()),i?n==t:n.toLowerCase()==t.toLowerCase()),w=(n,t)=>n&&Array.isArray(n)&&n.map(n=>a(n,t));y=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent);l={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:["blur","tab","enter"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownItemHidden:"tagify__dropdown__item--hidden",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!0,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve(),beforeKeyDown:()=>Promise.resolve()}};it={events:{binding(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var i=this.dropdown.events.callbacks,n=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:i.onKeyDown.bind(this),onMouseOver:i.onMouseOver.bind(this),onMouseLeave:i.onMouseLeave.bind(this),onClick:i.onClick.bind(this),onScroll:i.onScroll.bind(this)},t=r?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(document[t]("scroll",n.position,!0),window[t]("resize",n.position),window[t]("keydown",n.onKeyDown));this.DOM.dropdown[t]("mouseover",n.onMouseOver);this.DOM.dropdown[t]("mouseleave",n.onMouseLeave);this.DOM.dropdown[t]("mousedown",n.onClick);this.DOM.dropdown.content[t]("scroll",n.onScroll)},callbacks:{onKeyDown(n){if(this.state.hasFocus&&!this.state.composing){var i=this.settings,t=this.DOM.dropdown.querySelector(i.classNames.dropdownItemActiveSelector),u=this.dropdown.getSuggestionDataByNode(t),r="mix"==i.mode;i.hooks.beforeKeyDown(n,{tagify:this}).then(()=>{var e,f,o;switch(n.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":n.preventDefault();e=this.dropdown.getAllSuggestionsRefs();f="ArrowUp"==n.key||"Up"==n.key;t&&(t=this.dropdown.getNextOrPrevOption(t,!f));t&&t.matches(i.classNames.dropdownItemSelector)||(t=e[f?e.length-1:0]);this.dropdown.highlightOption(t,!0);break;case"Escape":case"Esc":this.dropdown.hide();break;case"ArrowRight":if(this.state.actions.ArrowLeft)return;case"Tab":{let f=!i.autoComplete.rightKey||!i.autoComplete.tabKey;return!r&&t&&f&&!this.state.editing?(n.preventDefault(),o=this.dropdown.getMappedValue(u),this.input.autocomplete.set.call(this,o),!1):!0}case"Enter":n.preventDefault();i.hooks.suggestionClick(n,{tagify:this,tagData:u,suggestionElm:t}).then(()=>{if(t)return this.dropdown.selectOption(t),t=this.dropdown.getNextOrPrevOption(t,!f),void this.dropdown.highlightOption(t);this.dropdown.hide();r||this.addTags(this.state.inputText.trim(),!0)}).catch(n=>Tagify.logger.warn(n));break;case"Backspace":{if(r||this.state.editing.scope)return;const n=this.input.raw.call(this);""!=n&&8203!=n.charCodeAt(0)||(!0===i.backspace?this.removeTags():"edit"==i.backspace&&setTimeout(this.editTag.bind(this),0))}}})}},onMouseOver(n){var t=n.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(t)},onMouseLeave(){this.dropdown.highlightOption()},onClick(n){if(0==n.button&&n.target!=this.DOM.dropdown&&n.target!=this.DOM.dropdown.content){var t=n.target.closest(this.settings.classNames.dropdownItemSelector),i=this.dropdown.getSuggestionDataByNode(t);this.state.actions.selectOption=!0;setTimeout(()=>this.state.actions.selectOption=!1,50);this.settings.hooks.suggestionClick(n,{tagify:this,tagData:i,suggestionElm:t}).then(()=>{t?this.dropdown.selectOption(t,n):this.dropdown.hide()}).catch(n=>Tagify.logger.warn(n))}},onScroll(n){var t=n.target,i=t.scrollTop/(t.scrollHeight-t.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(i)})}}},refilter(n){n=n||this.state.dropdown.query||"";this.suggestedListItems=this.dropdown.filterListItems(n);this.dropdown.fill();this.suggestedListItems.length||this.dropdown.hide();this.trigger("dropdown:updated",this.DOM.dropdown)},getSuggestionDataByNode(n){var t=n&&n.getAttribute("value");return this.suggestedListItems.find(n=>n.value==t)||null},getNextOrPrevOption(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=this.dropdown.getAllSuggestionsRefs(),i=t.findIndex(t=>t===n);return r?t[i+1]:t[i-1]},highlightOption(n,t){var i,r=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(r),this.state.ddItemElm.removeAttribute("aria-selected")),!n)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);i=this.dropdown.getSuggestionDataByNode(n);this.state.ddItemData=i;this.state.ddItemElm=n;n.classList.add(r);n.setAttribute("aria-selected",!0);t&&(n.parentNode.scrollTop=n.clientHeight+n.offsetTop-n.parentNode.clientHeight);this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,i),this.dropdown.position())},selectOption(n,i){var u=this.settings,o=u.dropdown,h=o.clearOnSelect,f=o.closeOnSelect;if(!n)return this.addTags(this.state.inputText,!0),void(f&&this.dropdown.hide());i=i||{};var e=n.getAttribute("value"),c="noMatch"==e,s="mix"==u.mode,r=this.suggestedListItems.find(n=>(n.value??n)==e);if(this.trigger("dropdown:select",{data:r,elm:n,event:i}),e&&(r||c)){if(this.state.editing){let n=this.normalizeTags([r])[0];r=u.transformTag.call(this,n)||n;this.onEditTagDone(null,t({__isValid:!0},r))}else this[s?"addMixTags":"addTags"]([r||this.input.raw.call(this)],h);(s||this.DOM.input.parentNode)&&(setTimeout(()=>{this.DOM.input.focus(),this.toggleFocusClass(!0)}),f&&setTimeout(this.dropdown.hide.bind(this)),n.addEventListener("transitionend",()=>{this.dropdown.fillHeaderFooter(),setTimeout(()=>n.remove(),100)},{once:!0}),n.classList.add(this.settings.classNames.dropdownItemHidden))}else f&&setTimeout(this.dropdown.hide.bind(this))},selectAll(n){this.suggestedListItems.length=0;this.dropdown.hide();this.dropdown.filterListItems("");var t=this.dropdown.filterListItems("");return n||(t=this.state.dropdown.suggestions),this.addTags(t,!0),this},filterListItems(n,t){function b(n,t){return t.toLowerCase().split(" ").every(t=>n.includes(t.toLowerCase()))}var f,v,o,p,u,l=this.settings,i=l.dropdown,e=(t=t||{},[]),a=[],s=l.whitelist,w=i.maxItems>=0?i.maxItems:1/0,y=i.searchKeys,h=0;if(!(n="select"==l.mode&&this.value.length&&this.value[0][l.tagTextProp]==n?"":n)||!y.length)return e=i.includeSelectedTags?s:s.filter(n=>!this.isTagDuplicate(r(n)?n.value:n)),this.state.dropdown.suggestions=e,e.slice(0,w);for(u=i.caseSensitive?""+n:(""+n).toLowerCase();h<s.length;h++){let n,l;f=s[h]instanceof Object?s[h]:{value:s[h]};let w=Object.keys(f).some(n=>y.includes(n))?y:["value"];i.fuzzySearch&&!t.exact?(o=w.reduce((n,t)=>n+" "+(f[t]||""),"").toLowerCase().trim(),i.accentedSearch&&(o=c(o),u=c(u)),n=0==o.indexOf(u),l=o===u,v=b(o,u)):(n=!0,v=w.some(n=>{var r=""+(f[n]||"");return i.accentedSearch&&(r=c(r),u=c(u)),i.caseSensitive||(r=r.toLowerCase()),l=r===u,t.exact?r===u:0==r.indexOf(u)}));p=!i.includeSelectedTags&&this.isTagDuplicate(r(f)?f.value:f);v&&!p&&(l&&n?a.push(f):"startsWith"==i.sortby&&n?e.unshift(f):e.push(f))}return this.state.dropdown.suggestions=a.concat(e),"function"==typeof i.sortby?i.sortby(a.concat(e),u):a.concat(e).slice(0,w)},getMappedValue(n){var t=this.settings.dropdown.mapValueTo;return t?"function"==typeof t?t(n):n[t]||n.value:n.value},createListHTML(n){return t([],n).map(n=>{"string"!=typeof n&&"number"!=typeof n||(n={value:n});var t=this.dropdown.getMappedValue(n);return t="string"==typeof t&&this.settings.dropdown.escapeHTML?e(t):t,this.settings.templates.dropdownItem.apply(this,[i(i({},n),{},{mappedValue:t}),this])}).join("")}};rt=i(i({},it),{},{refs(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]);this.DOM.dropdown.content=this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-wrapper']")},getHeaderRef(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-header']")},getFooterRef(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-footer']")},getAllSuggestionsRefs(){return[...this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector)]},show(n){var i,u,f,t=this.settings,e="mix"==t.mode&&!t.enforceWhitelist,o=!t.whitelist||!t.whitelist.length,h="manual"==t.dropdown.position;if(n=void 0===n?this.state.inputText:n,!(o&&!e&&!t.templates.dropdownItemNoMatch||!1===t.dropdown.enable||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(n),n&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",n),t.templates.dropdownItemNoMatch&&(f=t.templates.dropdownItemNoMatch.call(this,{value:n}))),!f){if(this.suggestedListItems.length)n&&e&&!this.state.editing.scope&&!s(this.suggestedListItems[0].value,n)&&this.suggestedListItems.unshift({value:n});else{if(!n||!e||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:n}]}u=""+(r(i=this.suggestedListItems[0])?i.value:i);t.autoComplete&&u&&0==u.indexOf(n)&&this.input.autocomplete.suggest.call(this,i)}this.dropdown.fill(f);t.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(t.classNames.dropdownItemSelector));this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this));this.state.dropdown.visible=n||!0;this.state.dropdown.query=n;this.setStateSelection();h||setTimeout(()=>{this.dropdown.position(),this.dropdown.render()});setTimeout(()=>{this.trigger("dropdown:show",this.DOM.dropdown)})}},hide(n){var i=this.DOM,r=i.scope,t=i.dropdown,u="manual"==this.settings.dropdown.position&&!n;if(t&&document.body.contains(t)&&!u)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),r.setAttribute("aria-expanded",!1),t.parentNode.removeChild(t),setTimeout(()=>{this.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",t),this},toggle(n){this.dropdown[this.state.dropdown.visible&&!n?"hide":"show"]()},getAppendTarget(){var n=this.settings.dropdown;return"function"==typeof n.appendTarget?n.appendTarget():n.appendTarget},render(){var i,n,r=((n=this.DOM.dropdown.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(n),i=n.clientHeight,n.parentNode.removeChild(n),i),t=this.settings,u="number"==typeof t.dropdown.enabled&&t.dropdown.enabled>=0,f=this.dropdown.getAppendTarget();return u?(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(t.classNames.dropdownInital),this.dropdown.position(r),f.appendChild(this.DOM.dropdown),setTimeout(()=>this.DOM.dropdown.classList.remove(t.classNames.dropdownInital))),this):this},fill(n){n="string"==typeof n?n:this.dropdown.createListHTML(n||this.suggestedListItems);var t,i=this.settings.templates.dropdownContent.call(this,n);this.DOM.dropdown.content.innerHTML=(t=i)?t.replace(/\>[\r\n ]+\</g,"><").split(/>\s+</).join("><").trim():""},fillHeaderFooter(){var n=this.dropdown.filterListItems(this.state.dropdown.query),t=this.parseTemplate("dropdownHeader",[n]),i=this.parseTemplate("dropdownFooter",[n]),r=this.dropdown.getHeaderRef(),u=this.dropdown.getFooterRef();t&&r?.parentNode.replaceChild(t,r);i&&u?.parentNode.replaceChild(i,u)},position(n){var u=this.settings.dropdown,f=this.dropdown.getAppendTarget();if("manual"!=u.position&&f){var t,i,r,h,e,o,v,y,p,s=this.DOM.dropdown,b=u.RTL,w=f===document.body,c=f===this.DOM.scope,k=w?window.pageYOffset:f.scrollTop,l=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,d=l.clientHeight,a=Math.max(l.clientWidth||0,window.innerWidth||0)>480?u.position:"all",g=this.DOM["input"==a?"input":"scope"];if(n=n||s.clientHeight,this.state.dropdown.visible){if("text"==a?(r=(t=function(){const n=document.getSelection();if(n.rangeCount){const f=n.getRangeAt(0),t=f.startContainer,u=f.startOffset;let i,r;if(u>0)return r=document.createRange(),r.setStart(t,u-1),r.setEnd(t,u),i=r.getBoundingClientRect(),{left:i.right,top:i.top,bottom:i.bottom};if(t.getBoundingClientRect)return t.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,i=t.top,h=t.left,e="auto"):(o=function(n){var t=0,i=0;for(n=n.parentNode;n&&n!=l;)t+=n.offsetTop||0,i+=n.offsetLeft||0,n=n.parentNode;return{top:t,left:i}}(f),t=g.getBoundingClientRect(),i=c?-1:t.top-o.top,r=(c?t.height:t.bottom-o.top)-1,h=c?-1:t.left-o.left,e=t.width+"px"),!w){let n=function(){for(var t=0,n=u.appendTarget.parentNode;n;)t+=n.scrollTop||0,n=n.parentNode;return t}();i+=n;r+=n}i=Math.floor(i);r=Math.ceil(r);y=((v=u.placeAbove??d-t.bottom<n)?i:r)+k;p=`left: ${h+(b&&t.width||0)+window.pageXOffset}px;`;s.style.cssText=`${p}; top: ${y}px; min-width: ${e}; max-width: ${e}`;s.setAttribute("placement",v?"top":"bottom");s.setAttribute("position",a)}}}});const h="@yaireo/tagify/";var ut,ot={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},st={wrapper:(n,t)=>`<tags class="${t.classNames.namespace} ${t.mode?`${t.classNames[t.mode+"Mode"]}`:""} ${n.className}"
                    ${t.readonly?"readonly":""}
                    ${t.disabled?"disabled":""}
                    ${t.required?"required":""}
                    ${"select"===t.mode?"spellcheck='false'":""}
                    tabIndex="-1">
            <span ${!t.readonly&&t.userInput?"contenteditable":""} tabIndex="0" data-placeholder="${t.placeholder||"&#8203;"}" aria-placeholder="${t.placeholder||""}"
                class="${t.classNames.input}"
                role="textbox"
                aria-autocomplete="both"
                aria-multiline="${"mix"==t.mode}"></span>
                &#8203;
        </tags>`,tag(n,t){let i=t.settings;return`<tag title="${n.title||n.value}"
                    contenteditable='false'
                    spellcheck='false'
                    tabIndex="${i.a11y.focusableTags?0:-1}"
                    class="${i.classNames.tag} ${n.class||""}"
                    ${this.getAttributes(n)}>
            <x title='' class="${i.classNames.tagX}" role='button' aria-label='remove tag'></x>
            <div>
                <span class="${i.classNames.tagText}">${n[i.tagTextProp]||n.value}</span>
            </div>
        </tag>`},dropdown(n){var t=n.dropdown;return`<div class="${"manual"==t.position?"":n.classNames.dropdown} ${t.classname}" role="listbox" aria-labelledby="dropdown" dir="${t.RTL?"rtl":""}">
                    <div data-selector='tagify-suggestions-wrapper' class="${n.classNames.dropdownWrapper}"></div>
                </div>`},dropdownContent(n){var t=this.settings.templates,i=this.state.dropdown.suggestions;return`
            ${t.dropdownHeader.call(this,i)}
            ${n}
            ${t.dropdownFooter.call(this,i)}
        `},dropdownItem(n){return`<div ${this.getAttributes(n)}
                    class='${this.settings.classNames.dropdownItem} ${n.class||""}'
                    tabindex="0"
                    role="option">${n.mappedValue||n.value}</div>`},dropdownHeader(){return`<header data-selector='tagify-suggestions-header' class="${this.settings.classNames.dropdownHeader}"></header>`},dropdownFooter(n){var t=n.length-this.settings.dropdown.maxItems;return t>0?`<footer data-selector='tagify-suggestions-footer' class="${this.settings.classNames.dropdownFooter}">
                ${t} more items. Refine your search.
            </footer>`:""},dropdownItemNoMatch:null},ht={customBinding(){this.customEventsList.forEach(n=>{this.on(n,this.settings.callbacks[n])})},binding(){var t,u;let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var r,f=this.settings,n=this.events.callbacks,e=i?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!i){for(t in this.state.mainEvents=i,i&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),r=this.listeners.main=this.listeners.main||{focus:["input",n.onFocusBlur.bind(this)],keydown:["input",n.onKeydown.bind(this)],click:["scope",n.onClickScope.bind(this)],dblclick:"select"!=f.mode&&["scope",n.onDoubleClickScope.bind(this)],paste:["input",n.onPaste.bind(this)],drop:["input",n.onDrop.bind(this)],compositionstart:["input",n.onCompositionStart.bind(this)],compositionend:["input",n.onCompositionEnd.bind(this)]})r[t]&&this.DOM[r[t][0]][e](t,r[t][1]);clearInterval(this.listeners.main.originalInputValueObserverInterval);this.listeners.main.originalInputValueObserverInterval=setInterval(n.observeOriginalInputValue.bind(this),500);u=this.listeners.main.inputMutationObserver||new MutationObserver(n.onInputDOMChange.bind(this));u.disconnect();"mix"==f.mode&&u.observe(this.DOM.input,{childList:!0})}},bindGlobal(n){var t,i=this.events.callbacks,r=n?"removeEventListener":"addEventListener";if(this.listeners&&(n||!this.listeners.global))for(t of this.listeners.global=this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:i[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:i.onWindowKeyDown.bind(this)},{type:"blur",target:this.DOM.input,cb:i.onFocusBlur.bind(this)},{type:"click",target:document,cb:i.onClickAnywhere.bind(this),useCapture:!0}],this.listeners.global)t.target[r](t.type,t.cb,!!t.useCapture)},unbindGlobal(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur(n){var t=this.settings,r=n.target?this.trim(n.target.textContent):"",e=this.value?.[0]?.[t.tagTextProp],i=n.type,f=t.dropdown.enabled>=0,u={relatedTarget:n.relatedTarget},o=this.state.actions.selectOption&&(f||!t.dropdown.closeOnSelect),s=this.state.actions.addNew&&f;if("blur"==i){if(n.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate();t.onChangeAfterBlur&&this.triggerChangeEvent()}if(!o&&!s)if(this.state.hasFocus="focus"==i&&+new Date,this.toggleFocusClass(this.state.hasFocus),"mix"!=t.mode){if("focus"==i)return this.trigger("focus",u),void(0!==t.dropdown.enabled&&t.userInput||this.state.dropdown.visible||this.dropdown.show(this.value.length?"":void 0));"blur"==i&&(this.trigger("blur",u),this.loading(!1),"select"==t.mode&&e===r&&(r=""),r&&!this.state.actions.selectOption&&t.addTagOnBlur&&t.addTagOn.includes("blur")&&this.addTags(r,!0));this.DOM.input.removeAttribute("style");this.dropdown.hide()}else"focus"==i?this.trigger("focus",u):"blur"==n.type&&(this.trigger("blur",u),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart(){this.state.composing=!0},onCompositionEnd(){this.state.composing=!1},onWindowKeyDown(n){var i,t=document.activeElement,r=o.call(this,t)&&this.DOM.scope.contains(document.activeElement),u=r&&t.hasAttribute("readonly");if(r&&!u)switch(i=t.nextElementSibling,n.key){case"Backspace":this.settings.readonly||(this.removeTags(t),(i||this.DOM.input).focus());break;case"Enter":setTimeout(this.editTag.bind(this),0,t)}},onKeydown(t){var i=this.settings,r;!this.state.composing&&i.userInput&&("select"==i.mode&&i.enforceWhitelist&&this.value.length&&"Tab"!=t.key&&t.preventDefault(),r=this.trim(t.target.textContent),this.trigger("keydown",{event:t}),i.hooks.beforeKeyDown(t,{tagify:this}).then(()=>{var a,o,v,h,p,c;if("mix"==i.mode){switch(t.key){case"Left":case"ArrowLeft":this.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(this.state.editing)return;var u=document.getSelection(),s="Delete"==t.key&&u.anchorOffset==(u.anchorNode.length||0),l=u.anchorNode.previousSibling,e=1==u.anchorNode.nodeType||!u.anchorOffset&&l&&1==l.nodeType&&u.anchorNode.previousSibling;if(b(this.DOM.input.innerHTML),h=this.getTagElms(),p=1===u.anchorNode.length&&u.anchorNode.nodeValue==String.fromCharCode(8203),"edit"==i.backspace&&e)return a=1==u.anchorNode.nodeType?null:u.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,a),void t.preventDefault();if(y()&&e instanceof Element)return v=k(e),e.hasAttribute("readonly")||e.remove(),this.DOM.input.focus(),void setTimeout(()=>{f(v),this.DOM.input.click()});if("BR"==u.anchorNode.nodeName)return;if(((s||e)&&1==u.anchorNode.nodeType?o=0==u.anchorOffset?s?h[0]:null:h[Math.min(h.length,u.anchorOffset)-1]:s?o=u.anchorNode.nextElementSibling:e instanceof Element&&(o=e),3==u.anchorNode.nodeType&&!u.anchorNode.nodeValue&&u.anchorNode.previousElementSibling&&t.preventDefault(),(e||s)&&!i.backspace)||"Range"!=u.type&&!u.anchorOffset&&u.anchorNode==this.DOM.input&&"Delete"!=t.key)return void t.preventDefault();if("Range"!=u.type&&o&&o.hasAttribute("readonly"))return void f(k(o));"Delete"==t.key&&p&&n(u.anchorNode.nextSibling)&&this.removeTags(u.anchorNode.nextSibling);clearTimeout(ut);ut=setTimeout(()=>{var t=document.getSelection();b(this.DOM.input.innerHTML);!s&&t.anchorNode.previousSibling;this.value=[].map.call(h,(t,i)=>{var r=n(t);if(t.parentNode||r.readonly)return r;this.trigger("remove",{tag:t,index:i,data:r})}).filter(n=>n)},20)}return!0}c="manual"==i.dropdown.position;switch(t.key){case"Backspace":"select"==i.mode&&i.enforceWhitelist&&this.value.length?this.removeTags():this.state.dropdown.visible&&"manual"!=i.dropdown.position||""!=t.target.textContent&&8203!=r.charCodeAt(0)||(!0===i.backspace?this.removeTags():"edit"==i.backspace&&setTimeout(this.editTag.bind(this),0));break;case"Esc":case"Escape":if(this.state.dropdown.visible)return;t.target.blur();break;case"Down":case"ArrowDown":this.state.dropdown.visible||this.dropdown.show();break;case"ArrowRight":{let n=this.state.inputSuggestion||this.state.ddItemData;if(n&&i.autoComplete.rightKey)return void this.addTags([n],!0);break}case"Tab":{let n="select"==i.mode;if(!r||n)return!0;t.preventDefault()}case"Enter":if(this.state.dropdown.visible&&!c)return;t.preventDefault();setTimeout(()=>{this.state.dropdown.visible&&!c||this.state.actions.selectOption||!i.addTagOn.includes(t.key.toLowerCase())||this.addTags(r,!0)})}}).catch(n=>n))},onInput(n){var i;if(this.postUpdate(),i=this.settings,"mix"==i.mode)return this.events.callbacks.onMixTagsInput.call(this,n);var t=this.input.normalize.call(this,void 0,{trim:!1}),f=t.length>=i.dropdown.enabled,r={value:t,inputElm:this.DOM.input},u=this.validateTag({value:t});"select"==i.mode&&this.toggleScopeValidation(u);r.isValid=u;this.state.inputText!=t&&(this.input.set.call(this,t,!1),-1!=t.search(i.delimiters)?this.addTags(t)&&this.input.set.call(this):i.dropdown.enabled>=0&&this.dropdown[f?"show":"hide"](t),this.trigger("input",r))},onMixTagsInput(i){var e,c,l,o,a,u,s,v,r=this.settings,w=this.value.length,p=this.getTagElms(),h=document.createDocumentFragment(),f=window.getSelection().getRangeAt(0),b=[].map.call(p,t=>n(t).value);if("deleteContentBackward"==i.inputType&&y()&&this.events.callbacks.onKeydown.call(this,{target:i.target,key:"Backspace"}),tt(this.getTagElms()),this.value.slice().forEach(n=>{n.readonly&&!b.includes(n.value)&&h.appendChild(this.createTagElem(n))}),h.childNodes.length&&(f.insertNode(h),this.setRangeAtStartEnd(!1,h.lastChild)),p.length!=w)return this.value=[].map.call(this.getTagElms(),t=>n(t)),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(u=window.getSelection()).rangeCount>0&&3==u.anchorNode.nodeType){if((f=u.getRangeAt(0).cloneRange()).collapse(!0),f.setStart(u.focusNode,0),l=(e=f.toString().slice(0,f.endOffset)).split(r.pattern).length-1,(c=e.match(r.pattern))&&(o=e.slice(e.lastIndexOf(c[c.length-1]))),o){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:o.match(r.pattern)[0],value:o.replace(r.pattern,"")},this.state.tag.baseOffset=u.baseOffset-this.state.tag.value.length,v=this.state.tag.value.match(r.delimiters))return this.state.tag.value=this.state.tag.value.replace(r.delimiters,""),this.state.tag.delimiters=v[0],this.addTags(this.state.tag.value,r.dropdown.clearOnSelect),void this.dropdown.hide();a=this.state.tag.value.length>=r.dropdown.enabled;try{s=(s=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&s.value[0]==this.state.tag.value[0];this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(i){}(s||l<this.state.mixMode.matchedPatternCount)&&(a=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=l}setTimeout(()=>{this.update({withoutChangeEvent:!0}),this.trigger("input",t({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[a?"show":"hide"](this.state.tag.value)},10)},onInputIE(n){var t=this;setTimeout(function(){t.events.callbacks.onInput.call(t,n)})},observeOriginalInputValue(){this.DOM.originalInput.parentNode||this.destroy();this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere(n){n.target==this.DOM.scope||this.DOM.scope.contains(n.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1,!this.settings.userInput&&this.dropdown.hide())},onClickScope(t){var r=this.settings,u=t.target.closest("."+r.classNames.tag),f=t.target===this.DOM.scope,e=+new Date-this.state.hasFocus;if(f&&"select"!=r.mode)this.DOM.input.focus();else{if(!t.target.classList.contains(r.classNames.tagX))return u&&!this.state.editing?(this.trigger("click",{tag:u,index:this.getNodeIndex(u),data:n(u),event:t}),void(1!==r.editTags&&1!==r.editTags.clicks&&"select"!=r.mode||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&("mix"==r.mode&&this.fixFirefoxLastTagNoCaret(),e>500)?this.state.dropdown.visible?this.dropdown.hide():0===r.dropdown.enabled&&"mix"!=r.mode&&this.dropdown.show(this.value.length?"":void 0):"select"!=r.mode||0!==r.dropdown.enabled||this.state.dropdown.visible||(this.events.callbacks.onDoubleClickScope.call(this,i(i({},t),{},{target:this.getTagElms()[0]})),!r.userInput&&this.dropdown.show()));this.removeTags(t.target.parentNode)}},onPaste(n){n.preventDefault();var u,i,r,t=this.settings;if("select"==t.mode&&t.enforceWhitelist||!t.userInput)return!1;t.readonly||(i=n.clipboardData||window.clipboardData,r=i.getData("Text"),t.hooks.beforePaste(n,{tagify:this,pastedText:r,clipboardData:i}).then(t=>{void 0===t&&(t=r),t&&(this.injectAtCaret(t,window.getSelection().getRangeAt(0)),"mix"==this.settings.mode?this.events.callbacks.onMixTagsInput.call(this,n):this.settings.pasteAsTags?u=this.addTags(this.state.inputText+t,!0):(this.state.inputText=t,this.dropdown.show(t))),this.trigger("paste",{event:n,pastedText:r,clipboardData:i,tagsElems:u})}).catch(n=>n))},onDrop(n){n.preventDefault()},onEditTagInput(i,r){var u=i.closest("."+this.settings.classNames.tag),s=this.getNodeIndex(u),f=n(u),e=this.input.normalize.call(this,i),h={[this.settings.tagTextProp]:e,__tagId:f.__tagId},o=this.validateTag(h);this.editTagChangeDetected(t(f,h))||!0!==i.originalIsValid||(o=!0);u.classList.toggle(this.settings.classNames.tagInvalid,!0!==o);f.__isValid=o;u.title=!0===o?f.title||f.value:o;e.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=e),this.dropdown.show(e));this.trigger("edit:input",{tag:u,index:s,data:t({},this.value[s],{newValue:e}),event:r})},onEditTagPaste(n,t){var r=(t.clipboardData||window.clipboardData).getData("Text"),i;t.preventDefault();i=nt(r);this.setRangeAtStartEnd(!1,i)},onEditTagClick(n,t){this.events.callbacks.onClickScope.call(this,t)},onEditTagFocus(n){this.state.editing={scope:n,input:n.querySelector("[contenteditable]")}},onEditTagBlur(i,r){if(o.call(this,r.relatedTarget)&&r.relatedTarget.contains(r.target))this.dropdown.hide();else if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(i))){var a,u,f=this.settings,e=i.closest("."+f.classNames.tag),c=n(e),l=this.input.normalize.call(this,i),v={[f.tagTextProp]:l,__tagId:c.__tagId},s=c.__originalData,y=this.editTagChangeDetected(t(c,v)),h=this.validateTag(v);if(l)if(y){if(a=this.hasMaxTags(),u=t({},s,{[f.tagTextProp]:this.trim(l),__isValid:h}),f.transformTag.call(this,u,s),!0!==(h=(!a||!0===s.__isValid)&&this.validateTag(u))){if(this.trigger("invalid",{data:u,tag:e,message:h}),f.editTags.keepInvalid)return;f.keepInvalidTags?u.__isValid=h:u=s}else f.keepInvalidTags&&(delete u.title,delete u["aria-invalid"],delete u.class);this.onEditTagDone(e,u)}else this.onEditTagDone(e,s);else this.onEditTagDone(e)}},onEditTagkeydown(n,t){if(!this.state.composing)switch(this.trigger("edit:keydown",{event:n}),n.key){case"Esc":case"Escape":this.state.editing=!1;t.__tagifyTagData.__originalData.value?t.parentNode.replaceChild(t.__tagifyTagData.__originalHTML,t):t.remove();break;case"Enter":case"Tab":n.preventDefault();setTimeout(()=>n.target.blur(),0)}},onDoubleClickScope(t){var u,f,i=t.target.closest("."+this.settings.classNames.tag),e=n(i),r=this.settings;i&&!1!==e.editable&&(u=i.classList.contains(this.settings.classNames.tagEditing),f=i.hasAttribute("readonly"),r.readonly||u||f||!this.settings.editTags||!r.userInput||this.editTag(i),this.toggleFocusClass(!0),"select"!=r.mode&&this.trigger("dblclick",{tag:i,index:this.getNodeIndex(i),data:n(i)}))},onInputDOMChange(t){t.forEach(t=>{t.addedNodes.forEach(t=>{if("<div><br><\/div>"==t.outerHTML)t.replaceWith(document.createElement("br"));else if(1==t.nodeType&&t.querySelector(this.settings.classNames.tagSelector)){let n=document.createTextNode("");3==t.childNodes[0].nodeType&&"BR"!=t.previousSibling.nodeName&&(n=document.createTextNode("\n"));t.replaceWith(n,...[...t.childNodes].slice(0,-1));f(n)}else if(o.call(this,t))if(3!=t.previousSibling?.nodeType||t.previousSibling.textContent||t.previousSibling.remove(),t.previousSibling&&"BR"==t.previousSibling.nodeName){t.previousSibling.replaceWith("\n​");let n=t.nextSibling,i="";for(;n;)i+=n.textContent,n=n.nextSibling;i.trim()&&f(t.previousSibling)}else t.previousSibling&&!n(t.previousSibling)||t.before("​")}),t.removedNodes.forEach(n=>{n&&"BR"==n.nodeName&&o.call(this,i)&&(this.removeTags(i),this.fixFirefoxLastTagNoCaret())})});var i=this.DOM.input.lastChild;i&&""==i.nodeValue&&i.remove();i&&"BR"==i.nodeName||this.DOM.input.appendChild(document.createElement("br"))}}};return u.prototype={_dropdown:rt,placeCaretAfterNode:f,getSetTagData:n,helpers:{sameStr:s,removeCollectionProp:w,omit:a,isObject:r,parseHTML:v,escapeHTML:e,extend:t,concatWithoutDups:d,getUID:g,isNodeTag:o},customEventsList:["change","add","remove","invalid","input","paste","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim(n){return this.settings.trim&&n&&"string"==typeof n?n.trim():n},parseHTML:v,templates:st,parseTemplate(n,t){return v((n=this.settings.templates[n]||n).apply(this,t))},set whitelist(n){const t=n&&Array.isArray(n);this.settings.whitelist=t?n:[];this.setPersistedData(t?n:[],"whitelist")},get whitelist(){return this.settings.whitelist},generateClassSelectors(n){for(let t in n){let i=t;Object.defineProperty(n,i+"Selector",{get(){return"."+this[i].split(" ")[0]}})}},applySettings(n,u){l.templates=this.templates;var s=t({},l,"mix"==u.mode?{dropdown:{position:"text"}}:{}),f=this.settings=t({},s,u);if(f.disabled=n.hasAttribute("disabled"),f.readonly=f.readonly||n.hasAttribute("readonly"),f.placeholder=e(n.getAttribute("placeholder")||f.placeholder||""),f.required=n.hasAttribute("required"),this.generateClassSelectors(f.classNames),void 0===f.dropdown.includeSelectedTags&&(f.dropdown.includeSelectedTags=f.duplicates),this.isIE&&(f.autoComplete=!1),["whitelist","blacklist"].forEach(t=>{var i=n.getAttribute("data-"+t);i&&(i=i.split(f.delimiters))instanceof Array&&(f[t]=i)}),"autoComplete"in u&&!r(u.autoComplete)&&(f.autoComplete=l.autoComplete,f.autoComplete.enabled=u.autoComplete),"mix"==f.mode&&(f.pattern=f.pattern||/@/,f.autoComplete.rightKey=!0,f.delimiters=u.delimiters||null,f.tagTextProp&&!f.dropdown.searchKeys.includes(f.tagTextProp)&&f.dropdown.searchKeys.push(f.tagTextProp)),n.pattern)try{f.pattern=new RegExp(n.pattern)}catch(n){}if(f.delimiters){f._delimiters=f.delimiters;try{f.delimiters=new RegExp(this.settings.delimiters,"g")}catch(n){}}f.disabled&&(f.userInput=!1);this.TEXTS=i(i({},ot),f.texts||{});("select"!=f.mode||u.dropdown?.enabled)&&f.userInput||(f.dropdown.enabled=0);f.dropdown.appendTarget=u.dropdown?.appendTarget||document.body;let o=this.getPersistedData("whitelist");Array.isArray(o)&&(this.whitelist=Array.isArray(f.whitelist)?d(f.whitelist,o):o)},getAttributes(n){var t,i=this.getCustomAttributes(n),r="";for(t in i)r+=" "+t+(void 0!==n[t]?`="${i[t]}"`:"");return r},getCustomAttributes(n){if(!r(n))return"";var t,i={};for(t in n)"__"!=t.slice(0,2)&&"class"!=t&&n.hasOwnProperty(t)&&void 0!==n[t]&&(i[t]=e(n[t]));return i},setStateSelection(){var n=window.getSelection(),t={anchorOffset:n.anchorOffset,anchorNode:n.anchorNode,range:n.getRangeAt&&n.rangeCount&&n.getRangeAt(0)};return this.state.selection=t,t},getCSSVars(){var n=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(n=>{let t=n.value;return"s"==n.unit?1e3*t:t})(function(n){if(!n)return{};var t=(n=n.trim().split(" ")[0]).split(/\d+/g).filter(n=>n).pop().trim();return{value:+n.split(t).filter(n=>n)[0].trim(),unit:t}}(n.getPropertyValue("--tag-hide-transition")))}},build(n){var t=this.DOM,i=n.closest("label");this.settings.mixMode.integrated?(t.originalInput=null,t.scope=n,t.input=n):(t.originalInput=n,t.originalInput_tabIndex=n.tabIndex,t.scope=this.parseTemplate("wrapper",[n,this.settings]),t.input=t.scope.querySelector(this.settings.classNames.inputSelector),n.parentNode.insertBefore(t.scope,n),n.tabIndex=-1);i&&i.setAttribute("for","")},destroy(){this.events.unbindGlobal.call(this);this.DOM.scope.parentNode.removeChild(this.DOM.scope);this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex;delete this.DOM.originalInput.__tagify;this.dropdown.hide(!0);clearTimeout(this.dropdownHide__bindEventsTimeout);clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues(n){var i,t=this.settings;if(this.state.blockChangeEvent=!0,void 0===n){const i=this.getPersistedData("value");n=i&&!this.DOM.originalInput.value?i:t.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),n)if("mix"==t.mode)this.parseMixTags(n),(i=this.DOM.input.lastChild)&&"BR"==i.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(n)instanceof Array&&(n=JSON.parse(n))}catch(n){}this.addTags(n,!0).forEach(n=>n&&n.classList.add(t.classNames.tagNoAnimation))}else this.postUpdate();this.state.lastOriginalValueReported=t.mixMode.integrated?"":this.DOM.originalInput.value},cloneEvent(n){var i={};for(var t in n)"path"!=t&&(i[t]=n[t]);return i},loading(n){return this.state.isLoading=n,this.DOM.scope.classList[n?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading(n,t){return n&&n.classList[t?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass(n,t){"string"==typeof n&&this.DOM.scope.classList.toggle(n,t)},toggleScopeValidation(n){var t=!0===n||void 0===n;!this.settings.required&&n&&n===this.TEXTS.empty&&(t=!0);this.toggleClass(this.settings.classNames.tagInvalid,!t);this.DOM.scope.title=t?"":n},toggleFocusClass(n){this.toggleClass(this.settings.classNames.focus,!!n)},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var n=this.DOM.originalInput,i=this.state.lastOriginalValueReported!==n.value,t=new CustomEvent("change",{bubbles:!0});i&&(this.state.lastOriginalValueReported=n.value,t.simulated=!0,n._valueTracker&&n._valueTracker.setValue(Math.random()),n.dispatchEvent(t),this.trigger("change",this.state.lastOriginalValueReported),n.value=this.state.lastOriginalValueReported)}},events:ht,fixFirefoxLastTagNoCaret(){},setRangeAtStartEnd(n,t){if(t){n="number"==typeof n?n:!!n;t=t.lastChild||t;var i=document.getSelection();if(i.focusNode instanceof Element&&!this.DOM.input.contains(i.focusNode))return!0;try{i.rangeCount>=1&&["Start","End"].forEach(r=>i.getRangeAt(0)["set"+r](t,n||t.length))}catch(n){console.warn(n)}}},insertAfterTag(n,t){if(t=t||this.settings.mixMode.insertAfterTag,n&&n.parentNode&&t)return t="string"==typeof t?document.createTextNode(t):t,n.parentNode.insertBefore(t,n.nextSibling),t},editTagChangeDetected(n){var i=n.__originalData;for(var t in i)if(!this.dataProps.includes(t)&&n[t]!=i[t])return!0;return!1},getTagTextNode(n){return n.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode(n,t){this.getTagTextNode(n).innerHTML=e(t)},editTag(i,r){i=i||this.getLastTag();r=r||{};this.dropdown.hide();var s=this.settings,f=this.getTagTextNode(i),c=this.getNodeIndex(i),e=n(i),o=this.events.callbacks,h=!0;if(f){if(!(e instanceof Object&&"editable"in e)||e.editable)return e=n(i,{__originalData:t({},e),__originalHTML:i.cloneNode(!0)}),n(e.__originalHTML,e.__originalData),f.setAttribute("contenteditable",!0),i.classList.add(s.classNames.tagEditing),f.addEventListener("click",o.onEditTagClick.bind(this,i)),f.addEventListener("focus",o.onEditTagFocus.bind(this,i)),f.addEventListener("blur",o.onEditTagBlur.bind(this,this.getTagTextNode(i))),f.addEventListener("input",o.onEditTagInput.bind(this,f)),f.addEventListener("paste",o.onEditTagPaste.bind(this,f)),f.addEventListener("keydown",n=>o.onEditTagkeydown.call(this,n,i)),f.addEventListener("compositionstart",o.onCompositionStart.bind(this)),f.addEventListener("compositionend",o.onCompositionEnd.bind(this)),r.skipValidation||(h=this.editTagToggleValidity(i)),f.originalIsValid=h,this.trigger("edit:start",{tag:i,index:c,data:e,isValid:h}),f.focus(),this.setRangeAtStartEnd(!1,f),0===s.dropdown.enabled&&this.dropdown.show(),this.state.hasFocus=!0,this}else u.logger.warn("Cannot find element in Tag template: .",s.classNames.tagTextSelector)},editTagToggleValidity(t,i){var r;if(i=i||n(t))return(r=!("__isValid"in i)||!0===i.__isValid)||this.removeTagsFromValue(t),this.update(),t.classList.toggle(this.settings.classNames.tagNotAllowed,!r),i.__isValid=r,i.__isValid;u.logger.warn("tag has no data: ",t,i)},onEditTagDone(t,i){i=i||{};var u,e={tag:t=t||this.state.editing.scope,index:this.getNodeIndex(t),previousData:n(t),data:i},r=this.settings;this.trigger("edit:beforeUpdate",e,{cloneData:!1});this.state.editing=!1;delete i.__originalData;delete i.__originalHTML;t&&((u=i[r.tagTextProp])?u.trim?.():r.tagTextProp in i?void 0:i.value)?(t=this.replaceTag(t,i),this.editTagToggleValidity(t,i),r.a11y.focusableTags?t.focus():f(t)):t&&this.removeTags(t);this.trigger("edit:updated",e);this.dropdown.hide();this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(n,i){i&&""!==i.value&&void 0!==i.value||(i=n.__tagifyTagData);i.__isValid&&1!=i.__isValid&&t(i,this.getInvalidTagAttrs(i,i.__isValid));var r=this.createTagElem(i);return n.parentNode.replaceChild(r,n),this.updateValueByDOMTags(),r},updateValueByDOMTags(){this.value.length=0;[].forEach.call(this.getTagElms(),t=>{t.classList.contains(this.settings.classNames.tagNotAllowed.split(" ")[0])||this.value.push(n(t))});this.update()},injectAtCaret(n,t){if(!(t=t||this.state.selection?.range)&&n)return this.appendMixTags(n),this;let i=nt(n,t);return this.setRangeAtStartEnd(!1,i),this.updateValueByDOMTags(),this.update(),this},input:{set(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=this.settings.dropdown.closeOnSelect;this.state.inputText=n;t&&(this.DOM.input.innerHTML=e(""+n));!n&&i&&this.dropdown.hide.bind(this);this.input.autocomplete.suggest.call(this);this.input.validate.call(this)},raw(){return this.DOM.input.textContent},validate(){var n=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!n),n},normalize(n,t){var r=n||this.DOM.input,i=[];r.childNodes.forEach(n=>3==n.nodeType&&i.push(n.nodeValue));i=i.join("\n");try{i=i.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(n){}return i=i.replace(/\s/g," "),t?.trim?this.trim(i):i},autocomplete:{suggest(n){var t;if(this.settings.autoComplete.enabled&&("object"!=typeof(n=n||{value:""})&&(n={value:n}),t=this.dropdown.getMappedValue(n),"number"!=typeof t)){var i=this.state.inputText.toLowerCase(),r=t.substr(0,this.state.inputText.length).toLowerCase(),u=t.substring(this.state.inputText.length);t&&this.state.inputText&&r==i?(this.DOM.input.setAttribute("data-suggest",u),this.state.inputSuggestion=n):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}},set(n){var i=this.DOM.input.getAttribute("data-suggest"),t=n||(i?this.state.inputText+i:null);return!!t&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+t)):(this.input.set.call(this,t),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx(n){return this.value.findIndex(t=>t.__tagId==(n||{}).__tagId)},getNodeIndex(n){var t=0;if(n)for(;n=n.previousElementSibling;)t++;return t},getTagElms(){for(var r,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return r="."+[...this.settings.classNames.tag.split(" "),...i].join("."),[].slice.call(this.DOM.scope.querySelectorAll(r))},getLastTag(){var n=this.DOM.scope.querySelectorAll(`${this.settings.classNames.tagSelector}:not(.${this.settings.classNames.tagHide}):not([readonly])`);return n[n.length-1]},isTagDuplicate(n,t,i){var r=0;if("select"==this.settings.mode)return!1;for(let u of this.value)s(this.trim(""+n),u.value,t)&&i!=u.__tagId&&r++;return r},getTagIndexByValue(n){var t=[],i=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((r,u)=>{r.__tagifyTagData&&s(this.trim(r.__tagifyTagData.value),n,i)&&t.push(u)}),t},getTagElmByValue(n){var t=this.getTagIndexByValue(n)[0];return this.getTagElms()[t]},flashTag(n){n&&(n.classList.add(this.settings.classNames.tagFlash),setTimeout(()=>{n.classList.remove(this.settings.classNames.tagFlash)},100))},isTagBlacklisted(n){return n=this.trim(n.toLowerCase()),this.settings.blacklist.filter(t=>(""+t).toLowerCase()==n).length},isTagWhitelisted(n){return!!this.getWhitelistItem(n)},getWhitelistItem(n,t,i){t=t||"value";var u,r=this.settings;return(i=i||r.whitelist).some(i=>{var f="string"==typeof i?i:i[t]||i.value;if(s(f,n,r.dropdown.caseSensitive,r.trim))return u="string"==typeof i?{value:i}:i,!0}),u||"value"!=t||"value"==r.tagTextProp||(u=this.getWhitelistItem(n,r.tagTextProp,i)),u},validateTag(n){var t=this.settings,r="value"in n?"value":t.tagTextProp,i=this.trim(n[r]+"");return(n[r]+"").trim()?"mix"!=t.mode&&t.pattern&&t.pattern instanceof RegExp&&!t.pattern.test(i)?this.TEXTS.pattern:!t.duplicates&&this.isTagDuplicate(i,t.dropdown.caseSensitive,n.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(i)||t.enforceWhitelist&&!this.isTagWhitelisted(i)?this.TEXTS.notAllowed:!t.validate||t.validate(n):this.TEXTS.empty},getInvalidTagAttrs(n,t){return{"aria-invalid":!0,"class":`${n.class||""} ${this.settings.classNames.tagNotAllowed}`.trim(),title:t}},hasMaxTags(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly(n,t){var i=this.settings;document.activeElement.blur();i[t||"readonly"]=n;this.DOM.scope[(n?"set":"remove")+"Attribute"](t||"readonly",!0);this.settings.userInput=!0;this.setContentEditable(!n)},setContentEditable(n){this.settings.userInput&&(this.DOM.input.contentEditable=n,this.DOM.input.tabIndex=n?0:-1)},setDisabled(n){this.setReadonly(n,"disabled")},normalizeTags(n){var r=this.settings,u=r.whitelist,o=r.delimiters,s=r.mode,t=r.tagTextProp,i=[],h=!!u&&u[0]instanceof Object,f=Array.isArray(n),c=f&&n[0].value,e=n=>(n+"").split(o).filter(n=>n).map(n=>({[t]:this.trim(n),value:this.trim(n)}));if("number"==typeof n&&(n=n.toString()),"string"==typeof n){if(!n.trim())return[];n=e(n)}else f&&(n=[].concat(...n.map(n=>null!=n.value?n:e(n))));return h&&!c&&(n.forEach(n=>{var f=i.map(n=>n.value),r=this.dropdown.filterListItems.call(this,n[t],{exact:!0}),u;this.settings.duplicates||(r=r.filter(n=>!f.includes(n.value)));u=r.length>1?this.getWhitelistItem(n[t],t,r):r[0];u&&u instanceof Object?i.push(u):"mix"!=s&&(null==n.value&&(n.value=n[t]),i.push(n))}),i.length&&(n=i)),n},parseMixTags(t){var i=this.settings,r=i.mixTagsInterpolator,o=i.duplicates,s=i.transformTag,h=i.enforceWhitelist,c=i.maxTags,e=i.tagTextProp,u=[],f;return t=t.split(r[0]).map((n,t)=>{var v,i,a,l=n.split(r[1]),f=l[0],y=u.length==c;try{if(f==+f)throw Error;i=JSON.parse(f)}catch(n){i=this.normalizeTags(f)[0]||{value:f}}if(s.call(this,i),!y&&l.length>1&&(!h||this.isTagWhitelisted(i.value))&&(o||!this.isTagDuplicate(i.value)))i[v=i[e]?e:"value"]=this.trim(i[v]),a=this.createTagElem(i),u.push(i),a.classList.add(this.settings.classNames.tagNoAnimation),l[0]=a.outerHTML,this.value.push(i);else if(n)return t?r[0]+n:n;return l.join("")}).join(""),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize(),f=this.getTagElms(),f.forEach((t,i)=>n(t,u[i])),this.update({withoutChangeEvent:!0}),tt(f,this.state.hasFocus),t},replaceTextWithNode(n,t){if(this.state.tag||t){t=t||this.state.tag.prefix+this.state.tag.value;var r,u,f=this.state.selection||window.getSelection(),i=f.anchorNode,e=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return i.splitText(f.anchorOffset-e),-1==(r=i.nodeValue.lastIndexOf(t))||(u=i.splitText(r),n&&i.parentNode.replaceChild(n,u)),!0}},prepareNewTagNode(n,i){i=i||{};var u=this.settings,f=[],r={},e=Object.assign({},n,{value:n.value+""});if(n=Object.assign({},e),u.transformTag.call(this,n),n.__isValid=this.hasMaxTags()||this.validateTag(n),!0!==n.__isValid){if(i.skipInvalid)return;if(t(r,this.getInvalidTagAttrs(n,n.__isValid),{__preInvalidData:e}),n.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(n.value)),!u.createInvalidTags)return void f.push(n.value)}return"readonly"in n&&(n.readonly?r["aria-readonly"]=!0:delete n.readonly),{tagElm:this.createTagElem(n,r),tagData:n,aggregatedInvalidInput:f}},postProcessNewTagNode(n,t){var r=this.settings,i=t.__isValid;i&&!0===i?(this.value.push(t),this.trigger("add",{tag:n,index:this.value.length-1,data:t})):(this.trigger("invalid",{data:t,index:this.value.length,tag:n,message:i}),r.keepInvalidTags||setTimeout(()=>this.removeTags(n,!0),1e3));this.dropdown.position()},selectTag(n,t){if(!this.settings.enforceWhitelist||this.isTagWhitelisted(t.value)){this.state.actions.selectOption&&setTimeout(()=>this.setRangeAtStartEnd(!1,this.DOM.input));var i=this.getLastTag();return i?this.replaceTag(i,t):this.appendTag(n),this.value[0]=t,this.update(),this.trigger("add",{tag:n,data:t}),[n]}},addEmptyTag(i){var u=t({value:""},i||{}),r=this.createTagElem(u);n(r,u);this.appendTag(r);this.editTag(r,{skipValidation:!0});this.toggleFocusClass(!0)},addTags(n,t,i){var u=[],r=this.settings,f=[],e=document.createDocumentFragment();if(!n||0==n.length)return u;switch(n=this.normalizeTags(n),r.mode){case"mix":return this.addMixTags(n);case"select":t=!1;this.removeAllTags()}return this.DOM.input.removeAttribute("style"),n.forEach(n=>{const t=this.prepareNewTagNode(n,{skipInvalid:i||r.skipInvalid});if(t){const o=t.tagElm;if(n=t.tagData,f=t.aggregatedInvalidInput,u.push(o),"select"==r.mode)return this.selectTag(o,n);e.appendChild(o);this.postProcessNewTagNode(o,n)}}),this.appendTag(e),this.update(),n.length&&t&&(this.input.set.call(this,r.createInvalidTags?"":f.join(r._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),r.dropdown.enabled&&this.dropdown.refilter(),u},addMixTags(n){if((n=this.normalizeTags(n))[0].prefix||this.state.tag)return this.prefixedTextToTag(n[0]);var t=document.createDocumentFragment();return n.forEach(n=>{const i=this.prepareNewTagNode(n);t.appendChild(i.tagElm);this.postProcessNewTagNode(tagElm,i.tagData)}),this.appendMixTags(t),t},appendMixTags(n){var t=!!this.state.selection;t?this.injectAtCaret(n):(this.DOM.input.focus(),(t=this.setStateSelection()).range.setStart(this.DOM.input,t.range.endOffset),t.range.setEnd(this.DOM.input,t.range.endOffset),this.DOM.input.appendChild(n),this.updateValueByDOMTags(),this.update())},prefixedTextToTag(n){var t,i,r=this.settings,e=this.state.tag?.delimiters,u;return(n.prefix=n.prefix||this.state.tag?this.state.tag.prefix:(r.pattern.source||r.pattern)[0],i=this.prepareNewTagNode(n),t=i.tagElm,this.replaceTextWithNode(t)||this.DOM.input.appendChild(t),setTimeout(()=>t.classList.add(this.settings.classNames.tagNoAnimation),300),this.value.push(i.tagData),this.update(),e)||(u=this.insertAfterTag(t)||t,setTimeout(f,0,u)),this.state.tag=null,this.postProcessNewTagNode(t,i.tagData),t},appendTag(n){var t=this.DOM,i=t.input;t.scope.insertBefore(n,i)},createTagElem(r,u){r.__tagId=g();var f,o=t({},r,i({value:e(r.value+"")},u));return function(n){for(var t,i=document.createNodeIterator(n,NodeFilter.SHOW_TEXT,null,!1);t=i.nextNode();)t.textContent.trim()||t.parentNode.removeChild(t)}(f=this.parseTemplate("tag",[o,this])),n(f,r),f},reCheckInvalidTags(){var t=this.settings;this.getTagElms(t.classNames.tagNotAllowed).forEach(i=>{var r=n(i),f=this.hasMaxTags(),u=this.validateTag(r),e=!0===u&&!f;if("select"==t.mode&&this.toggleScopeValidation(u),e)return r=r.__preInvalidData?r.__preInvalidData:{value:r.value},this.replaceTag(i,r);i.title=f||u})},removeTags(t,i,r){var u,f=this.settings;if(t=t&&t instanceof HTMLElement?[t]:t instanceof Array?t:t?[t]:[this.getLastTag()],u=t.reduce((t,i)=>{i&&"string"==typeof i&&(i=this.getTagElmByValue(i));var r=n(i);return i&&r&&!r.readonly&&t.push({node:i,idx:this.getTagIdx(r),data:n(i,{__removed:!0})}),t},[]),r="number"==typeof r?r:this.CSSVars.tagHideTransition,"select"==f.mode&&(r=0,this.input.set.call(this)),1==u.length&&"select"!=f.mode&&u[0].node.classList.contains(f.classNames.tagNotAllowed)&&(i=!0),u.length)return f.hooks.beforeRemoveTag(u,{tagify:this}).then(()=>{function n(n){n.node.parentNode&&(n.node.parentNode.removeChild(n.node),i?f.keepInvalidTags&&this.trigger("remove",{tag:n.node,index:n.idx}):(this.trigger("remove",{tag:n.node,index:n.idx,data:n.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),f.keepInvalidTags&&this.reCheckInvalidTags()))}r&&r>10&&1==u.length?function(t){t.node.style.width=parseFloat(window.getComputedStyle(t.node).width)+"px";document.body.clientTop;t.node.classList.add(f.classNames.tagHide);setTimeout(n.bind(this),r,t)}.call(this,u[0]):u.forEach(n.bind(this));i||(this.removeTagsFromValue(u.map(n=>n.node)),this.update(),"select"==f.mode&&this.setContentEditable(!0))}).catch(()=>{})},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach(n=>n.parentNode.removeChild(n))},removeTagsFromValue(t){(t=Array.isArray(t)?t:[t]).forEach(t=>{var r=n(t),i=this.getTagIdx(r);i>-1&&this.value.splice(i,1)})},removeAllTags(n){n=n||{};this.value=[];"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM();this.dropdown.refilter();this.dropdown.position();this.state.dropdown.visible&&setTimeout(()=>{this.DOM.input.focus()});"select"==this.settings.mode&&(this.input.set.call(this),this.setContentEditable(!0));this.update(n)},postUpdate(){this.state.blockChangeEvent=!1;var n=this.settings,t=n.classNames,i="mix"==n.mode?n.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(t.hasMaxTags,this.value.length>=n.maxTags);this.toggleClass(t.hasNoTags,!this.value.length);this.toggleClass(t.empty,!i);"select"==n.mode&&this.toggleScopeValidation(this.value?.[0]?.__isValid)},setOriginalInputValue(n){var t=this.DOM.originalInput;this.settings.mixMode.integrated||(t.value=n,t.tagifyValue=t.value,this.setPersistedData(n,"value"))},update(n){clearTimeout(this.debouncedUpdateTimeout);this.debouncedUpdateTimeout=setTimeout(function(){var t=this.getInputValue();this.setOriginalInputValue(t);this.settings.onChangeAfterBlur&&(n||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent();this.postUpdate()}.bind(this),100)},getInputValue(){var n=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(n):n.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(n):JSON.stringify(n):""},getCleanValue(n){return w(n||this.value,this.dataProps)},getMixedTagsAsString(){var t="",r=this,i=this.settings,f=i.originalInputValueFormat||JSON.stringify,u=i.mixTagsInterpolator;return function i(e){e.childNodes.forEach(e=>{if(1==e.nodeType){const s=n(e);if("BR"==e.tagName&&(t+="\r\n"),s&&o.call(r,e)){if(s.__removed)return;t+=u[0]+f(a(s,r.dataProps))+u[1]}else e.getAttribute("style")||["B","I","U"].includes(e.tagName)?t+=e.textContent:"DIV"!=e.tagName&&"P"!=e.tagName||(t+="\r\n",i(e))}else t+=e.textContent})}(this.DOM.input),t}},u.prototype.removeTag=u.prototype.removeTags,u.logger={enabled:!1,log(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.enabled&&console.log("[Tagify]:",...i)},warn(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.enabled&&console.warn("[Tagify]:",...i)}},u};"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(i="undefined"!=typeof globalThis?globalThis:i||self).Tagify=t()}(jQuery);